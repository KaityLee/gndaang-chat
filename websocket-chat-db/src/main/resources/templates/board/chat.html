<!DOCTYPE html>
<html>
<head>
    <title>Chat App</title>
    <link rel="stylesheet" href="/css/chat.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/sockjs/1.1.4/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
    <div id="chat-container">
        <div id="message-container"></div>
        <input type="text" id="message-input">
        <button id="send-button">Send</button>
    </div>

    <script>
        $(document).ready(function() {
        	var socketUrl = "http://" + window.location.host + "/ws";
        	var socket = new SockJS(socketUrl);
            var stompClient = Stomp.over(socket);
            var roomId = "[[${roomId}]]"

            stompClient.connect({}, function(frame) {
                console.log('Connected: ' + frame);

            stompClient.subscribe('/topic/messages/' + roomId, function(response) {
                var messages = JSON.parse(response.body);
                displayMessages(messages);
              });
            });
            
            function displayMessages(messages) {
                var messageContainer = $('#message-container');

                  var messageDiv = $('<div class="message"></div>');
                  messageDiv.text(messages.sender + ': ' + messages.content);
                  messageContainer.append(messageDiv);
                  console.log('왜 안오노');
              }
            
            /*
            function displayMessages(messages) {
                var messageContainer = $('#message-container');
                messageContainer.empty();

                messages.forEach(function(message) {
                    var messageDiv = $('<div class="message"></div>');
                    messageDiv.text(message.sender + ': ' + message.content);
                    messageContainer.append(messageDiv);
                });
            }*/

            $('#send-button').click(function() {
                var messageInput = $('#message-input');
                var messageContent = messageInput.val();
                var sender = "[[${session.username}]]";
                var message = {
                    content: messageContent,
                    sender: sender,
                    roomId: roomId
                };

                stompClient.send("/app/chat/"+roomId, {}, JSON.stringify(message));
                messageInput.val("");
            });
        });
    </script>
</body>
</html>
